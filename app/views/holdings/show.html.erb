<%# Show a single holding and all its associated transactions %>
<%# You can add a transaction on the same page %>

<%# Flash message %>
<% if notice %>
  <div class="flash-message"><%= notice %></div>
<% end %>

<%# Table of transactions %>
<article>
  <div class="article-header">
    <div class="article-title">
      <h4><%= link_to "Portfolio: #{@portfolio.name}", @portfolio %></h4>
      <h4>Holding: <%= @holding.symbol %></h4>
      <h2>List of Transactions</h2>
    </div>
   
    <%= button_to "Delete", holding_path(@holding), method: :delete, data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this holding and all its transactions?" } %>
  </div>

  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Shares</th>
        <th>Cost</th>
        <th>Value</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody>
      <%# Selects all associated transactions at the outset, avoids N+1 queries %>
      <% @holding.transactions.each do |transaction| %>
      <tr onclick="window.location='<%= edit_transaction_path(transaction) %>';" style='cursor: pointer;'>
        <td><%= transaction.created_at.to_date %> </td>
        <td><%= sprintf('%.2f', transaction.quantity) %></td>
        <td><%= sprintf('%.2f', transaction.price) %></td>
        <td>$<%= sprintf('%.2f', 0) %></td>
        <td>$<%= sprintf('%.2f', transaction.quantity * transaction.price) %></td>
      </tr>
    <% end %>
    </tbody>
  </table>
</article>

<%# Form %>
<%= render "transactions/form", holding: @holding, transaction: @transaction, title: "Add Transaction", model: [@holding, @transaction] %>
