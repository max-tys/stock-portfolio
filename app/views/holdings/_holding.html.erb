<% if portfolio.holdings.empty? %>
  <p>This portfolio is currently empty.</p>
<% else %>
<table>
  <thead>
    <tr>
      <th>Symbol</th>
      <th>Quantity</th>
      <th>Average Cost</th>
      <th>Last Price</th>
      <th>Current Value</th>
    </tr>
  </thead>
  <tbody>
    <% portfolio.holdings.order(:symbol).each do |holding| %>
      <tr onclick="window.location='<%= holding_path(holding) %>';" style='cursor: pointer;'>
        <td><%= holding.symbol %></td>
        <td>
          <%= number_with_precision(quantity = holding.transactions.pluck(:quantity).sum, :precision => 2, :delimiter => ',') %>
        </td>
        <td>
          $ <%= number_with_precision(0, :precision => 2, :delimiter => ',') %>
        </td>
        <td>
          $ <%= 
          begin
            number_with_precision(last_price = finnhub_client.quote("#{holding.symbol}").c, :precision => 2, :delimiter => ',')
          rescue FinnhubRuby::ApiError
            '-'
          end
          %>
        </td>
        <td>
          $ <%= number_with_precision(quantity * last_price, :precision => 2, :delimiter => ',') %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
<% end %>